#!/usr/bin/env python3

import requests
import sys
import re
import eventlet
eventlet.monkey_patch()

IP = sys.argv[1]
PORT = 80
PATH = '/drive/'
TIMEOUT = 2

listing = requests.get(f'http://{IP}:{PORT}/{PATH}').text
links = re.findall('href="(\S*)"', listing)

print(links, flush=True)

for link in links:
    url = f'http://{IP}:{PORT}/{PATH}/{link}'
    try:
        with eventlet.Timeout(TIMEOUT):
            r = requests.get(url, timeout=TIMEOUT, verify=False)
            print(r.content, flush=True)
    except:
        pass
